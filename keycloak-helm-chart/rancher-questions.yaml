# Rancher Questions File
# This file defines the UI questions that appear in the Rancher App Catalog

categories:
  - Authentication
  - Security

questions:
# Keycloak Configuration
- variable: keycloak.replicas
  default: 2
  description: "Number of Keycloak replicas for high availability"
  type: int
  label: Keycloak Replicas
  required: true
  group: "Keycloak Configuration"

- variable: keycloak.auth.adminUser
  default: "admin"
  description: "Keycloak administrator username"
  type: string
  label: Admin Username
  required: true
  group: "Keycloak Configuration"

- variable: keycloak.auth.adminPassword
  default: ""
  description: "Keycloak administrator password (leave empty to auto-generate)"
  type: password
  label: Admin Password
  required: true
  group: "Keycloak Configuration"

- variable: keycloak.configuration.hostname
  default: "keycloak.example.com"
  description: "Public hostname for accessing Keycloak"
  type: hostname
  label: Keycloak Hostname
  required: true
  group: "Keycloak Configuration"

- variable: keycloak.image.tag
  default: "24.0.1"
  description: "Keycloak image tag/version"
  type: string
  label: Keycloak Version
  required: true
  group: "Keycloak Configuration"

# Resource Configuration
- variable: keycloak.resources.requests.cpu
  default: "500m"
  description: "CPU request for each Keycloak pod"
  type: string
  label: CPU Request
  group: "Resources"

- variable: keycloak.resources.requests.memory
  default: "512Mi"
  description: "Memory request for each Keycloak pod"
  type: string
  label: Memory Request
  group: "Resources"

- variable: keycloak.resources.limits.cpu
  default: "2000m"
  description: "CPU limit for each Keycloak pod"
  type: string
  label: CPU Limit
  group: "Resources"

- variable: keycloak.resources.limits.memory
  default: "2Gi"
  description: "Memory limit for each Keycloak pod"
  type: string
  label: Memory Limit
  group: "Resources"

# Database Configuration
- variable: postgresql.enabled
  default: true
  description: "Deploy PostgreSQL database with Keycloak"
  type: boolean
  label: Enable Built-in PostgreSQL
  show_subquestion_if: true
  required: true
  group: "Database"
  subquestions:
  - variable: postgresql.auth.password
    default: ""
    description: "PostgreSQL database password"
    type: password
    label: Database Password
    required: true

  - variable: postgresql.primary.persistence.size
    default: "8Gi"
    description: "PostgreSQL persistent volume size"
    type: string
    label: Database Storage Size
    required: true

  - variable: postgresql.primary.persistence.storageClass
    default: ""
    description: "Storage class for PostgreSQL (leave empty for default)"
    type: storageclass
    label: Database Storage Class

- variable: keycloak.configuration.database.hostname
  default: ""
  description: "External database hostname (only if built-in PostgreSQL is disabled)"
  type: string
  label: External Database Host
  show_if: "postgresql.enabled=false"
  group: "Database"

- variable: keycloak.configuration.database.port
  default: 5432
  description: "External database port"
  type: int
  label: External Database Port
  show_if: "postgresql.enabled=false"
  group: "Database"

- variable: keycloak.configuration.database.database
  default: "keycloak"
  description: "External database name"
  type: string
  label: External Database Name
  show_if: "postgresql.enabled=false"
  group: "Database"

- variable: keycloak.configuration.database.username
  default: "keycloak"
  description: "External database username"
  type: string
  label: External Database Username
  show_if: "postgresql.enabled=false"
  group: "Database"

- variable: keycloak.configuration.database.password
  default: ""
  description: "External database password"
  type: password
  label: External Database Password
  show_if: "postgresql.enabled=false"
  group: "Database"

# Ingress Configuration
- variable: ingress.enabled
  default: true
  description: "Enable ingress for external access"
  type: boolean
  label: Enable Ingress
  show_subquestion_if: true
  required: true
  group: "Ingress and TLS"
  subquestions:
  - variable: ingress.className
    default: "nginx"
    description: "Ingress class to use (nginx, traefik, etc.)"
    type: string
    label: Ingress Class
    required: true

  - variable: ingress.tls[0].secretName
    default: "keycloak-tls"
    description: "Name of the TLS secret"
    type: string
    label: TLS Secret Name

  - variable: ingress.annotations.cert-manager\.io/cluster-issuer
    default: "letsencrypt-prod"
    description: "Cert-manager cluster issuer for automatic TLS"
    type: string
    label: Cert-Manager Issuer

# Persistence Configuration
- variable: persistence.enabled
  default: true
  description: "Enable persistent storage for Keycloak data"
  type: boolean
  label: Enable Persistence
  show_subquestion_if: true
  group: "Storage"
  subquestions:
  - variable: persistence.size
    default: "1Gi"
    description: "Size of persistent volume"
    type: string
    label: Storage Size
    required: true

  - variable: persistence.storageClass
    default: ""
    description: "Storage class for Keycloak data (leave empty for default)"
    type: storageclass
    label: Storage Class

  - variable: persistence.accessMode
    default: "ReadWriteOnce"
    description: "Volume access mode"
    type: enum
    label: Access Mode
    options:
      - "ReadWriteOnce"
      - "ReadWriteMany"

# High Availability
- variable: podDisruptionBudget.enabled
  default: true
  description: "Enable Pod Disruption Budget for high availability"
  type: boolean
  label: Enable Pod Disruption Budget
  show_subquestion_if: true
  group: "High Availability"
  subquestions:
  - variable: podDisruptionBudget.minAvailable
    default: 1
    description: "Minimum number of pods that must be available"
    type: int
    label: Minimum Available Pods

- variable: autoscaling.enabled
  default: false
  description: "Enable horizontal pod autoscaling"
  type: boolean
  label: Enable Autoscaling
  show_subquestion_if: true
  group: "High Availability"
  subquestions:
  - variable: autoscaling.minReplicas
    default: 2
    description: "Minimum number of replicas"
    type: int
    label: Min Replicas

  - variable: autoscaling.maxReplicas
    default: 5
    description: "Maximum number of replicas"
    type: int
    label: Max Replicas

  - variable: autoscaling.targetCPUUtilizationPercentage
    default: 80
    description: "Target CPU utilization percentage for scaling"
    type: int
    label: Target CPU %

# Monitoring
- variable: rancher.monitoring.enabled
  default: true
  description: "Enable Rancher monitoring integration"
  type: boolean
  label: Enable Monitoring
  show_subquestion_if: true
  group: "Monitoring"
  subquestions:
  - variable: rancher.monitoring.serviceMonitor.enabled
    default: true
    description: "Create ServiceMonitor for Prometheus"
    type: boolean
    label: Enable ServiceMonitor

  - variable: rancher.monitoring.serviceMonitor.interval
    default: "30s"
    description: "Metrics scrape interval"
    type: string
    label: Scrape Interval

# Advanced Configuration
- variable: keycloak.configuration.proxy
  default: "edge"
  description: "Proxy mode for Keycloak"
  type: enum
  label: Proxy Mode
  group: "Advanced"
  options:
    - "edge"
    - "reencrypt"
    - "passthrough"

- variable: keycloak.configuration.logLevel
  default: "INFO"
  description: "Keycloak log level"
  type: enum
  label: Log Level
  group: "Advanced"
  options:
    - "ERROR"
    - "WARN"
    - "INFO"
    - "DEBUG"
    - "TRACE"

- variable: keycloak.configuration.cache.stack
  default: "kubernetes"
  description: "Cache stack for clustering"
  type: string
  label: Cache Stack
  group: "Advanced"
